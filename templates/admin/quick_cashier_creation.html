{% extends "admin/base_site.html" %} {% load static %} {% block title %}{{ title
}} | {{ site_title|default:"Django site admin" }}{% endblock %} {% block
extrastyle %} {{ block.super }}
<style>
    .form-container {
        max-width: 600px;
        margin: 0 auto;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .form-row {
        margin-bottom: 16px;
    }
    .form-row label {
        display: block;
        font-weight: bold;
        margin-bottom: 4px;
        color: #333;
    }
    .form-row input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        box-sizing: border-box;
    }
    .form-row input:focus {
        border-color: #007cba;
        outline: none;
        box-shadow: 0 0 0 2px rgba(0, 124, 186, 0.2);
    }
    .required {
        color: #dc3545;
    }
    .help-text {
        font-size: 12px;
        color: #666;
        margin-top: 4px;
    }
    .submit-button {
        background: #007cba;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
        margin-right: 12px;
    }
    .submit-button:hover {
        background: #005a87;
    }
    .cancel-button {
        background: #6c757d;
        color: white;
        text-decoration: none;
        padding: 12px 24px;
        border-radius: 4px;
        font-size: 16px;
        display: inline-block;
    }
    .cancel-button:hover {
        background: #545b62;
        color: white;
        text-decoration: none;
    }
    .info-box {
        background: #e8f4fd;
        border: 1px solid #bee5eb;
        border-radius: 4px;
        padding: 16px;
        margin-bottom: 24px;
    }
    .password-generator {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 12px;
        margin-top: 8px;
    }
    .generate-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 3px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 8px;
    }
    .generate-btn:hover {
        background: #218838;
    }
</style>
{% endblock %} {% block content %}
<div class="module">
    <h1>üîê Quick Cashier Creation</h1>

    <div class="info-box">
        <h3>‚ÑπÔ∏è About This Form</h3>
        <p>
            This form creates a new user and automatically adds them to the
            Cashier group with all necessary permissions.
        </p>
        <ul>
            <li>‚úÖ User will be created with cashier permissions</li>
            <li>‚úÖ Can immediately access the cashier dashboard</li>
            <li>‚úÖ Has all required order and table management permissions</li>
            <li>
                ‚ùå Will NOT have admin panel access (unless made staff
                separately)
            </li>
        </ul>
    </div>

    <div class="form-container">
        <form method="post">
            {% csrf_token %}

            <div class="form-row">
                <label for="username"
                    >Username <span class="required">*</span></label
                >
                <input
                    type="text"
                    id="username"
                    name="username"
                    required
                    placeholder="Enter username (e.g., john_cashier)"
                    pattern="[a-zA-Z0-9_.-]+"
                    title="Username can only contain letters, numbers, underscores, dots, and hyphens"
                />
                <div class="help-text">
                    Must be unique. Only letters, numbers, and _.- allowed.
                </div>
            </div>

            <div class="form-row">
                <label for="email">Email Address</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="cashier@restaurant.com"
                />
                <div class="help-text">
                    Optional but recommended for password recovery.
                </div>
            </div>

            <div class="form-row">
                <label for="first_name">First Name</label>
                <input
                    type="text"
                    id="first_name"
                    name="first_name"
                    placeholder="John"
                />
            </div>

            <div class="form-row">
                <label for="last_name">Last Name</label>
                <input
                    type="text"
                    id="last_name"
                    name="last_name"
                    placeholder="Doe"
                />
            </div>

            <div class="form-row">
                <label for="password"
                    >Password <span class="required">*</span></label
                >
                <input
                    type="password"
                    id="password"
                    name="password"
                    required
                    placeholder="Enter secure password"
                    minlength="8"
                />
                <div class="password-generator">
                    <strong>Password Generator:</strong>
                    <button
                        type="button"
                        class="generate-btn"
                        onclick="generatePassword()"
                    >
                        üé≤ Generate Strong Password
                    </button>
                    <div
                        id="generated-password"
                        style="
                            margin-top: 8px;
                            font-family: monospace;
                            font-weight: bold;
                            color: #007cba;
                        "
                    ></div>
                </div>
                <div class="help-text">
                    Minimum 8 characters. Use the generator for a secure
                    password.
                </div>
            </div>

            <div
                style="
                    margin-top: 32px;
                    border-top: 1px solid #eee;
                    padding-top: 16px;
                "
            >
                <button type="submit" class="submit-button">
                    ‚ûï Create Cashier User
                </button>
                <a
                    href="{% url 'admin:cashier_management' %}"
                    class="cancel-button"
                >
                    ‚ùå Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Additional Help -->
    <div
        style="
            margin-top: 32px;
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
        "
    >
        <h3>üìö After Creation</h3>
        <p>Once the cashier is created, they can:</p>
        <ul>
            <li>
                üö™ <strong>Login:</strong>
                <a href="/cashier/login/" target="_blank">Cashier Login Page</a>
            </li>
            <li>
                üìä <strong>Access:</strong> Cashier dashboard with order
                management
            </li>
            <li>üí≥ <strong>Process:</strong> Payments and table operations</li>
            <li>üìà <strong>View:</strong> Sales reports and statistics</li>
        </ul>

        <h4>Default Test Credentials:</h4>
        <div
            style="
                background: white;
                padding: 12px;
                border-radius: 4px;
                margin: 8px 0;
                font-family: monospace;
            "
        >
            <strong>Username:</strong> test_cashier<br />
            <strong>Password:</strong> cashier123
        </div>
    </div>
</div>

<script>
    // Password generator
    function generatePassword() {
        const chars =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";
        let password = "";

        // Ensure at least one of each type
        password += "ABCDEFGHIJKLMNOPQRSTUVWXYZ"[
            Math.floor(Math.random() * 26)
        ]; // Uppercase
        password += "abcdefghijklmnopqrstuvwxyz"[
            Math.floor(Math.random() * 26)
        ]; // Lowercase
        password += "0123456789"[Math.floor(Math.random() * 10)]; // Number
        password += "!@#$%^&*"[Math.floor(Math.random() * 8)]; // Special

        // Fill the rest
        for (let i = 4; i < 12; i++) {
            password += chars[Math.floor(Math.random() * chars.length)];
        }

        // Shuffle the password
        password = password
            .split("")
            .sort(() => Math.random() - 0.5)
            .join("");

        // Display and fill
        document.getElementById("generated-password").textContent = password;
        document.getElementById("password").value = password;

        // Show copy button
        const copyBtn = document.getElementById("copy-password-btn");
        if (!copyBtn) {
            const btn = document.createElement("button");
            btn.type = "button";
            btn.className = "generate-btn";
            btn.id = "copy-password-btn";
            btn.textContent = "üìã Copy";
            btn.onclick = () => {
                navigator.clipboard.writeText(password).then(() => {
                    btn.textContent = "‚úÖ Copied!";
                    setTimeout(() => (btn.textContent = "üìã Copy"), 2000);
                });
            };
            document.getElementById("generated-password").appendChild(btn);
        }
    }

    // Form validation
    document.querySelector("form").addEventListener("submit", function (e) {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        if (!username || !password) {
            alert("Username and password are required!");
            e.preventDefault();
            return;
        }

        if (password.length < 8) {
            alert("Password must be at least 8 characters long!");
            e.preventDefault();
            return;
        }

        // Confirm creation
        const confirmMsg = `Create cashier user "${username}"?\n\nThey will have access to:\n‚Ä¢ Cashier dashboard\n‚Ä¢ Order management\n‚Ä¢ Payment processing\n‚Ä¢ Table operations`;
        if (!confirm(confirmMsg)) {
            e.preventDefault();
        }
    });

    // Auto-focus username field
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById("username").focus();
    });

    // Username validation
    document.getElementById("username").addEventListener("input", function (e) {
        const value = e.target.value;
        const valid = /^[a-zA-Z0-9_.-]+$/.test(value);

        if (value && !valid) {
            e.target.style.borderColor = "#dc3545";
            e.target.style.backgroundColor = "#fff5f5";
        } else {
            e.target.style.borderColor = "#ccc";
            e.target.style.backgroundColor = "white";
        }
    });
</script>
{% endblock %}
