{% extends 'base.html' %} {% load static %} {% block title %}Find Your Orders -
River Side Food Court{% endblock %} {% block extra_css %}
<style>
    .search-container {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 50vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .search-card {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .table-number-input {
        font-size: 2rem;
        text-align: center;
        font-weight: bold;
    }

    .search-btn {
        transition: all 0.3s ease;
    }

    .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
</style>
{% endblock %} {% block content %}
<div class="search-container">
    <div class="container mx-auto px-4">
        <div class="max-w-md mx-auto">
            <div class="search-card card shadow-2xl">
                <div class="card-body text-center">
                    <!-- Header -->
                    <div class="mb-8">
                        <h1 class="text-3xl font-bold text-white mb-2">
                            üçΩÔ∏è Find Your Orders
                        </h1>
                        <p class="text-white/80">
                            Enter your table number to check order status
                        </p>
                    </div>

                    <!-- Search Form -->
                    <form id="table-search-form" class="space-y-6">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text text-white font-medium"
                                    >Table Number</span
                                >
                            </label>
                            <input
                                type="number"
                                id="table-number"
                                class="input input-bordered table-number-input bg-white/90 text-primary"
                                placeholder="5"
                                min="1"
                                max="50"
                                required
                                autofocus
                            />
                        </div>

                        <button
                            type="submit"
                            class="btn btn-primary btn-lg w-full search-btn"
                            id="search-btn"
                        >
                            <svg
                                class="w-5 h-5 mr-2"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                                ></path>
                            </svg>
                            Find My Orders
                        </button>
                    </form>

                    <!-- Quick Access -->
                    <div class="divider text-white/60">or</div>

                    <div class="space-y-3">
                        <a
                            href="{% url 'orders:table_selection' %}"
                            class="btn btn-outline btn-sm text-white border-white/50 hover:bg-white hover:text-primary"
                        >
                            üì± Place New Order
                        </a>

                        <div class="text-xs text-white/60">
                            Don't know your table number? Check the number on
                            your table.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Tables Section -->
<div class="bg-base-100 py-12">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-2xl font-bold text-center mb-8">
                üöÄ Quick Table Access
            </h2>

            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                {% for i in "123456789012345678901234"|make_list %} {% if
                forloop.counter <= 24 %}
                <a
                    href="{% url 'orders:track_orders_short' forloop.counter %}"
                    class="btn btn-outline btn-lg hover:btn-primary transition-all duration-200"
                >
                    Table {{ forloop.counter }}
                </a>
                {% endif %} {% endfor %}
            </div>

            <div class="text-center mt-8">
                <p class="text-base-content/60 text-sm">
                    üí° Click any table number above for quick access
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="error-modal" class="modal">
    <div class="modal-box">
        <h3 class="font-bold text-lg text-error">Table Not Found</h3>
        <p class="py-4" id="error-message">
            We couldn't find any orders for this table. Please check the table
            number or place a new order.
        </p>
        <div class="modal-action">
            <button
                class="btn btn-outline"
                onclick="document.getElementById('error-modal').classList.remove('modal-open')"
            >
                Try Again
            </button>
            <a
                href="{% url 'orders:table_selection' %}"
                class="btn btn-primary"
            >
                Place New Order
            </a>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loading-modal" class="modal">
    <div class="modal-box text-center">
        <span class="loading loading-spinner loading-lg text-primary"></span>
        <h3 class="font-bold text-lg mt-4">Searching for Orders...</h3>
        <p class="py-4">Please wait while we look up your table.</p>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("table-search-form");
        const tableInput = document.getElementById("table-number");
        const searchBtn = document.getElementById("search-btn");
        const loadingModal = document.getElementById("loading-modal");
        const errorModal = document.getElementById("error-modal");

        form.addEventListener("submit", async function (e) {
            e.preventDefault();

            const tableNumber = tableInput.value.trim();

            if (!tableNumber) {
                showError("Please enter a table number");
                return;
            }

            if (tableNumber < 1 || tableNumber > 50) {
                showError("Please enter a table number between 1 and 50");
                return;
            }

            // Show loading
            loadingModal.classList.add("modal-open");
            searchBtn.disabled = true;

            try {
                // Check if table exists and has orders
                const response = await fetch(
                    `/api/table-status/${tableNumber}/`,
                );

                if (response.ok) {
                    const data = await response.json();

                    // Hide loading
                    loadingModal.classList.remove("modal-open");

                    if (data.has_orders) {
                        // Redirect to track orders
                        window.location.href = `/track/${tableNumber}/`;
                    } else {
                        // Show no orders message
                        showError(
                            `No active orders found for Table ${tableNumber}. Would you like to place a new order?`,
                        );
                    }
                } else if (response.status === 404) {
                    loadingModal.classList.remove("modal-open");
                    showError(
                        `Table ${tableNumber} not found. Please check the table number.`,
                    );
                } else {
                    throw new Error("Failed to check table status");
                }
            } catch (error) {
                console.error("Error checking table:", error);
                loadingModal.classList.remove("modal-open");
                showError("Something went wrong. Please try again.");
            } finally {
                searchBtn.disabled = false;
            }
        });

        function showError(message) {
            document.getElementById("error-message").textContent = message;
            errorModal.classList.add("modal-open");
        }

        // Allow Enter key to submit
        tableInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                form.dispatchEvent(new Event("submit"));
            }
        });

        // Auto-focus and select text on page load
        tableInput.focus();
        tableInput.select();
    });
</script>
{% endblock %}
